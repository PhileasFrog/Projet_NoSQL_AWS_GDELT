{"paragraphs":[{"text":"%md\n## Jeu de donnees\nThe Global Database of Events, Language, and Tone (*GDELT*), est une initiative pour construire un catalogue de comportements et de croyances sociales à travers le monde, reliant chaque personne, organisation, lieu, dénombrement, thème, source d'information, et événement à travers la planète en un seul réseau massif qui capture ce qui se passe dans le monde, le contexte, les implications ainsi que la perception des gens sur chaque jour.\n\n\nCette base de données a eu beaucoup d'utilisations, par exemple pour mieux comprendre l'évolution et l'impact de la crise financière du 2008 (https://arxiv.org/pdf/1403.2272v1.pdf[Bayesian dynamic financial networks with time-varying predictors]) ou analyser l'évolution des relations entre des pays impliquées dans des conflits (http://www.gao.ece.ufl.edu/GXU/fun_reading/sbp_hurst.pdf[Massive Media Event Data Analysis to Assess World-Wide Political Conflict and Instability] ).\n\nGDELT est compose par trois jeux de fichiers CSV, avec un fichier compressé par tranche de 15 minutes:\n\n* les events (https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.events?tab=schema[schema], http://data.gdeltproject.org/documentation/CAMEO.Manual.1.1b3.pdf[CAMEO Ontology], http://data.gdeltproject.org/documentation/GDELT-Event_Codebook-V2.0.pdf[documentation])\n* les mentions (https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.eventmentions[schema], http://data.gdeltproject.org/documentation/GDELT-Event_Codebook-V2.0.pdf[documentation])\n* le graph des relations => GKG, Global Knowledge Graph (https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.gkg[schema], http://data.gdeltproject.org/documentation/GDELT-Global_Knowledge_Graph_Codebook-V2.1.pdf[documentation])\n\nL'ensemble des donnees _GDELT_ sont disponibles via HTTP. Un fichier CSV _masterfilelist.txt_\n(http://data.gdeltproject.org/gdeltv2/masterfilelist.txt[Master CSV data file list]) nous permmet d'avoir la liste de tous les fichiers du jeu de donnees GDELT ainsi que l'URL pour telecharger chaque fichier.\n\n\nPour plus d'infos sur le format des fichiers vous pouvez consulter la documentation GDELT: https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/\n","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Jeu de donnees</h2>\n<p>The Global Database of Events, Language, and Tone (*GDELT*), est une initiative pour construire un catalogue de comportements et de croyances sociales à travers le monde, reliant chaque personne, organisation, lieu, dénombrement, thème, source d&rsquo;information, et événement à travers la planète en un seul réseau massif qui capture ce qui se passe dans le monde, le contexte, les implications ainsi que la perception des gens sur chaque jour.</p>\n<p>Cette base de données a eu beaucoup d&rsquo;utilisations, par exemple pour mieux comprendre l&rsquo;évolution et l&rsquo;impact de la crise financière du 2008 (<a href=\"https://arxiv.org/pdf/1403.2272v1.pdf[Bayesian\">https://arxiv.org/pdf/1403.2272v1.pdf[Bayesian</a> dynamic financial networks with time-varying predictors]) ou analyser l&rsquo;évolution des relations entre des pays impliquées dans des conflits (<a href=\"http://www.gao.ece.ufl.edu/GXU/fun_reading/sbp_hurst.pdf[Massive\">http://www.gao.ece.ufl.edu/GXU/fun_reading/sbp_hurst.pdf[Massive</a> Media Event Data Analysis to Assess World-Wide Political Conflict and Instability] ).</p>\n<p>GDELT est compose par trois jeux de fichiers CSV, avec un fichier compressé par tranche de 15 minutes:</p>\n<ul>\n  <li>les events (<a href=\"https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.events?tab=schema[schema]\">https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.events?tab=schema[schema]</a>, <a href=\"http://data.gdeltproject.org/documentation/CAMEO.Manual.1.1b3.pdf[CAMEO\">http://data.gdeltproject.org/documentation/CAMEO.Manual.1.1b3.pdf[CAMEO</a> Ontology], <a href=\"http://data.gdeltproject.org/documentation/GDELT-Event_Codebook-V2.0.pdf[documentation]\">http://data.gdeltproject.org/documentation/GDELT-Event_Codebook-V2.0.pdf[documentation]</a>)</li>\n  <li>les mentions (<a href=\"https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.eventmentions[schema]\">https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.eventmentions[schema]</a>, <a href=\"http://data.gdeltproject.org/documentation/GDELT-Event_Codebook-V2.0.pdf[documentation]\">http://data.gdeltproject.org/documentation/GDELT-Event_Codebook-V2.0.pdf[documentation]</a>)</li>\n  <li>le graph des relations =&gt; GKG, Global Knowledge Graph (<a href=\"https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.gkg[schema]\">https://bigquery.cloud.google.com/table/gdelt-bq:gdeltv2.gkg[schema]</a>, <a href=\"http://data.gdeltproject.org/documentation/GDELT-Global_Knowledge_Graph_Codebook-V2.1.pdf[documentation]\">http://data.gdeltproject.org/documentation/GDELT-Global_Knowledge_Graph_Codebook-V2.1.pdf[documentation]</a>)</li>\n</ul>\n<p>L&rsquo;ensemble des donnees <em>GDELT</em> sont disponibles via HTTP. Un fichier CSV <em>masterfilelist.txt</em><br/>(<a href=\"http://data.gdeltproject.org/gdeltv2/masterfilelist.txt[Master\">http://data.gdeltproject.org/gdeltv2/masterfilelist.txt[Master</a> CSV data file list]) nous permmet d&rsquo;avoir la liste de tous les fichiers du jeu de donnees GDELT ainsi que l&rsquo;URL pour telecharger chaque fichier.</p>\n<p>Pour plus d&rsquo;infos sur le format des fichiers vous pouvez consulter la documentation GDELT: <a href=\"https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/\">https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/</a></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009227_2042309918","id":"20181212-100610_115068599","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3905"},{"text":"%md\nDans ce notebook nous allons telecharger les fichiers GDELT pour 2020.\nOn commence par definir une function *fileDownloder* qui telecharge un fichier a partir d'un URL.","user":"anonymous","dateUpdated":"2021-01-25T20:43:12+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Dans ce notebook nous allons telecharger les fichiers GDELT pour 2020.<br/>On commence par definir une function <em>fileDownloder</em> qui telecharge un fichier a partir d&rsquo;un URL.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009231_-2026422904","id":"20181212-100702_1116690996","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:43:12+0000","dateFinished":"2021-01-25T20:43:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3906"},{"text":"import sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection \nimport org.apache.spark.sql.functions._\n\n\ndef fileDownloader(urlOfFileToDownload: String, fileName: String) = {\n    val url = new URL(urlOfFileToDownload)\n    val connection = url.openConnection().asInstanceOf[HttpURLConnection]\n    connection.setConnectTimeout(5000)\n    connection.setReadTimeout(5000)\n    connection.connect()\n\n    if (connection.getResponseCode >= 400)\n        println(\"error\")\n    else\n        url #> new File(fileName) !!\n}","user":"anonymous","dateUpdated":"2021-01-25T20:38:02+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection\nimport org.apache.spark.sql.functions._\nwarning: there was one feature warning; re-run with -feature for details\nfileDownloader: (urlOfFileToDownload: String, fileName: String)Any\n"}]},"apps":[],"jobName":"paragraph_1611607009231_-930462996","id":"20181209-161931_737140067","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:38:02+0000","dateFinished":"2021-01-25T20:38:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3907"},{"text":"%md Initialisation des credentials AWS","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Initialisation des credentials AWS</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009232_454872077","id":"20210125-173818_1235216209","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3908"},{"text":"import com.amazonaws.services.s3.AmazonS3Client\r\nimport com.amazonaws.auth.BasicAWSCredentials\r\nimport com.amazonaws.auth.BasicSessionCredentials\r\nval AWS_ID=\"METTREVOTREAWSID\" // à renseigner depuis Vocareum\r\nval AWS_KEY=\"METTREVOTREAWSKEY\" // à renseigner depuis Vocareum\r\nval AWS_SESSION_TOKEN=\"METTREVOTREAWSSESSION\" // à renseigner depuis Vocareum nécessaire pour les comptes AWS EDUCATE !\r\n@transient val awsClient = new AmazonS3Client(new BasicSessionCredentials(AWS_ID, AWS_KEY, AWS_SESSION_TOKEN))\r\nsc.hadoopConfiguration.set(\"fs.s3.access.key\", AWS_ID) // mettre votre ID du fichier credentials.csv\r\nsc.hadoopConfiguration.set(\"fs.s3.secret.key\", AWS_KEY) // mettre votre secret du fichier credentials.csv\r\nsc.hadoopConfiguration.set(\"fs.s3.session.token\", AWS_SESSION_TOKEN)\r\nsc.hadoopConfiguration.setInt(\"fs.s3a.connection.maximum\", 3000)\r\n","user":"anonymous","dateUpdated":"2021-01-25T21:20:18+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\nimport com.amazonaws.auth.BasicSessionCredentials\nAWS_ID: String = METTREVOTREAWSID\nAWS_KEY: String = METTREVOTREAWSKEY\nAWS_SESSION_TOKEN: String = METTREVOTREAWSSESSION\nwarning: there was one deprecation warning; re-run with -deprecation for details\nawsClient: com.amazonaws.services.s3.AmazonS3Client = com.amazonaws.services.s3.AmazonS3Client@68a62305\n"}]},"apps":[],"jobName":"paragraph_1611607009232_811861252","id":"20210117-204735_260132551","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T21:20:19+0000","dateFinished":"2021-01-25T21:20:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3909"},{"text":"%md\nOn peut tester cette function pour telecharger en local le *masterfilelist* GDELT. Ce fichier sera stocké en local sur les disques EMR puis persisté sur AWS S3.","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>On peut tester cette function pour telecharger en local le <em>masterfilelist</em> GDELT. Ce fichier sera stocké en local sur les disques EMR puis persisté sur AWS S3.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009232_29232169","id":"20181212-101024_1671681559","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3910"},{"text":"fileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist.txt\", \"/mnt/tmp/masterfilelist.txt\") // save the list file to the Spark Master\nfileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist-translation.txt\", \"/mnt/tmp/masterfilelist_translation.txt\") // save the list file to the Spark Master\n","user":"anonymous","dateUpdated":"2021-01-25T20:42:24+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":490.4,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res10: Any = \"\"\nres11: Any = \"\"\n"}]},"apps":[],"jobName":"paragraph_1611607009233_860151613","id":"20181209-162121_1695304399","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:42:24+0000","dateFinished":"2021-01-25T20:42:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3911"},{"text":"%md\nOn peut verifier que le fichier a bien ete telecharge","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>On peut verifier que le fichier a bien ete telecharge</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009233_303624748","id":"20181212-101108_352331024","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3912"},{"text":"%sh\nls -lrth /mnt/tmp |grep masterfilelist","user":"anonymous","dateUpdated":"2021-01-25T20:43:26+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"-rw-r--r--  1 zeppelin zeppelin  63M Jan 25 20:42 masterfilelist.txt\n-rw-r--r--  1 zeppelin zeppelin  68M Jan 25 20:42 masterfilelist_translation.txt\n"}]},"apps":[],"jobName":"paragraph_1611607009233_-1894955877","id":"20181210-111357_801203770","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:43:26+0000","dateFinished":"2021-01-25T20:43:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3913"},{"text":"%md\nNous allons uploader le *masterfilelist.txt* dans notre bucket S3 via l'api scala AWS\nCette cellule ne doit pas être éxécutée pour le moment !","user":"anonymous","dateUpdated":"2021-01-25T20:43:36+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Nous allons uploader le <em>masterfilelist.txt</em> dans notre bucket S3 via l&rsquo;api scala AWS<br/>Cette cellule ne doit pas être éxécutée pour le moment !</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009233_1265651251","id":"20181212-101200_46908780","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:43:36+0000","dateFinished":"2021-01-25T20:43:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3914"},{"text":"// ! A modifier pour rediriger vers bucket S3 du compte AWS\n\n val DIRS3PERSO=\"premierbuckerdom1012\" //Dominique\n//val DIRS3PERSO=\"bcobucket-telecom-2020\" //Bertrand\n//val DIRS3PERSO=\"thomas-trivellato-gdelt2020\" //Tom\n//val DIRS3PERSO=\"rob-nob-telecom-gdelt2020\" //Roberto\n\n","user":"anonymous","dateUpdated":"2021-01-25T20:43:44+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DIRS3PERSO: String = premierbuckerdom1012\n"}]},"apps":[],"jobName":"paragraph_1611607009233_540839061","id":"20181212-095117_1356104178","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:43:44+0000","dateFinished":"2021-01-25T20:43:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3915"},{"text":"%md On upload les Master files dans le bucket S3","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>On upload les Master files dans le bucket S3</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009233_-223521019","id":"20181212-101258_954978327","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3916"},{"text":"awsClient.putObject(DIRS3PERSO, \"masterfilelist.txt\", new File(\"/mnt/tmp/masterfilelist.txt\") )\nawsClient.putObject(DIRS3PERSO, \"masterfilelist_translation.txt\", new File( \"/mnt/tmp/masterfilelist_translation.txt\") )","user":"anonymous","dateUpdated":"2021-01-25T20:43:51+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res18: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@44b96dd6\nres19: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@2780144a\n"}]},"apps":[],"jobName":"paragraph_1611607009234_-1460431206","id":"20210117-205221_1592244559","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:43:51+0000","dateFinished":"2021-01-25T20:43:54+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3917"},{"text":"%md Verifions que les fichiers ont bien ete uploades dans le bucket S3 via un dataframe Spark","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Verifions que les fichiers ont bien ete uploades dans le bucket S3 via un dataframe Spark</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009234_586612209","id":"20210125-173708_427572673","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3918"},{"text":"import org.apache.spark.sql.SQLContext\n\nval sqlContext = new SQLContext(sc)\nval filesDF = sqlContext.read.\n                    option(\"delimiter\",\" \").\n                    option(\"infer_schema\",\"true\").\n                    csv(\"s3://\" + DIRS3PERSO + \"/masterfilelist.txt\",\"s3://\" + DIRS3PERSO + \"/masterfilelist_translation.txt\").\n                    withColumnRenamed(\"_c0\",\"size\").\n                    withColumnRenamed(\"_c1\",\"hash\").\n                    withColumnRenamed(\"_c2\",\"url\").\n                    cache","user":"anonymous","dateUpdated":"2021-01-25T20:44:00+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.SQLContext\nwarning: there was one deprecation warning; re-run with -deprecation for details\nsqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@7a75c09\nfilesDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-6-204.ec2.internal:4040/jobs/job?id=0"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1611607009234_1552363757","id":"20181209-163052_14263535","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:44:00+0000","dateFinished":"2021-01-25T20:44:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3919"},{"text":"filesDF.show(false)","user":"anonymous","dateUpdated":"2021-01-25T20:44:31+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------------------+--------------------------------------------------------------------------------+\n|size   |hash                            |url                                                                             |\n+-------+--------------------------------+--------------------------------------------------------------------------------+\n|49305  |18f9b16f0bc6b1e203b963264b7c90f1|http://data.gdeltproject.org/gdeltv2/20150218224500.translation.export.CSV.zip  |\n|133082 |d019304ace29aec800f688b616fceb06|http://data.gdeltproject.org/gdeltv2/20150218224500.translation.mentions.CSV.zip|\n|9117874|fb4bb6d180eb8cde5825a8e6dbab1865|http://data.gdeltproject.org/gdeltv2/20150218224500.translation.gkg.csv.zip     |\n|59173  |b634baabd40fbe078f723829e7e4639f|http://data.gdeltproject.org/gdeltv2/20150218230000.translation.export.CSV.zip  |\n|151173 |19921c77b5d898f313ded534fdc1cd61|http://data.gdeltproject.org/gdeltv2/20150218230000.translation.mentions.CSV.zip|\n|9347350|db36bcb7337c67995cf642cff397a449|http://data.gdeltproject.org/gdeltv2/20150218230000.translation.gkg.csv.zip     |\n|61560  |438901a1a6b75d89c7475e0740a78d74|http://data.gdeltproject.org/gdeltv2/20150218231500.translation.export.CSV.zip  |\n|128215 |943cfb011bed59bf6957e20ca59e87f3|http://data.gdeltproject.org/gdeltv2/20150218231500.translation.mentions.CSV.zip|\n|9637181|1e345742a552d8251dc1b4c991a56f8f|http://data.gdeltproject.org/gdeltv2/20150218231500.translation.gkg.csv.zip     |\n|49096  |9d763e90b5a57a90e0600f37ba067c14|http://data.gdeltproject.org/gdeltv2/20150218233000.translation.export.CSV.zip  |\n|113273 |ef8af93958669cc1124dc77c52e852a6|http://data.gdeltproject.org/gdeltv2/20150218233000.translation.mentions.CSV.zip|\n|8590990|71271dcb812a1581fddb38ff803d1a51|http://data.gdeltproject.org/gdeltv2/20150218233000.translation.gkg.csv.zip     |\n|54081  |defacc35f0e858bc87bd09619aa6fdfa|http://data.gdeltproject.org/gdeltv2/20150218234500.translation.export.CSV.zip  |\n|127165 |ca78766b7499a649f6d5408b63ad65a2|http://data.gdeltproject.org/gdeltv2/20150218234500.translation.mentions.CSV.zip|\n|9016447|da1dbe6c4989fdc48fe45ddbfa320387|http://data.gdeltproject.org/gdeltv2/20150218234500.translation.gkg.csv.zip     |\n|132648 |84ac55ff9e0dcf91a044ea9e2c972ad8|http://data.gdeltproject.org/gdeltv2/20150219000000.translation.export.CSV.zip  |\n|111309 |9059cd44cfc0a2e38e39a5974ca614a6|http://data.gdeltproject.org/gdeltv2/20150219000000.translation.mentions.CSV.zip|\n|8564348|9c0b6080979f107dee9f9126ac78e1a0|http://data.gdeltproject.org/gdeltv2/20150219000000.translation.gkg.csv.zip     |\n|121175 |076734aa904bb95533ff06ffe34738a5|http://data.gdeltproject.org/gdeltv2/20150219001500.translation.export.CSV.zip  |\n|122744 |d65f88aea37ca71902f519ea5e0859d7|http://data.gdeltproject.org/gdeltv2/20150219001500.translation.mentions.CSV.zip|\n+-------+--------------------------------+--------------------------------------------------------------------------------+\nonly showing top 20 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-6-204.ec2.internal:4040/jobs/job?id=1"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1611607009234_-459840345","id":"20181209-185148_142944415","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:44:31+0000","dateFinished":"2021-01-25T20:44:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3920"},{"text":"%md Par la suite on va charger les fichiers zips gdelt qui correspondent à l'année 2020, ou à une partie pour des tests.","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Par la suite on va charger les fichiers zips gdelt qui correspondent à l&rsquo;année 2020, ou à une partie pour des tests.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009234_73829550","id":"20181212-101345_616653479","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3921"},{"text":"// on télécharges ici trois mois de données et on enlève les fichiers à problème\n// pour des tests on peut paramétrer les dates à télécharger via une regex sur les noms des zips\nval DATES = \"/20200[7-9]\"\nval sampleDF = filesDF.filter(col(\"url\").rlike(DATES)).filter(!(col(\"url\").contains(\"/20201214121500\"))).cache\n\n","user":"anonymous","dateUpdated":"2021-01-25T20:48:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DATES: String = /20200[7-9]\nsampleDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1611607009235_-773487673","id":"20181209-162427_816541907","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:48:08+0000","dateFinished":"2021-01-25T20:48:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3922"},{"text":"%md Nous allons charger tous ces fichiers dans le bucket S3 via un ETL Spark","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Nous allons charger tous ces fichiers dans le bucket S3 via un ETL Spark</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009235_2040995370","id":"20181212-101426_1390220831","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3923"},{"text":"val DIR_local = \"/mnt/tmp/\" //attention à modifier par rapport à l'instal utilisateur\n\nobject AwsClient{\n    val s3 = new AmazonS3Client(new BasicSessionCredentials(AWS_ID, AWS_KEY,AWS_SESSION_TOKEN ))\n}\n\n\nsampleDF.select(\"url\").repartition(100).foreach( r=> {\n            val URL = r.getAs[String](0)\n            val fileName = r.getAs[String](0).split(\"/\").last\n            //val dir = \"projet/download/\"\n            val localFileName = DIR_local + fileName\n            fileDownloader(URL,  localFileName)\n            val localFile = new File(localFileName)\n            AwsClient.s3.putObject(DIRS3PERSO + \"/zips\", fileName, localFile )\n            localFile.delete()\n            \n})","user":"anonymous","dateUpdated":"2021-01-25T20:48:14+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-6-204.ec2.internal:4040/jobs/job?id=2"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1611607009235_2054099321","id":"20181209-163933_1336720866","dateCreated":"2021-01-25T20:36:49+0000","dateStarted":"2021-01-25T20:48:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3924","dateFinished":"2021-01-25T21:12:09+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DIR_local: String = /mnt/tmp/\nwarning: there was one deprecation warning; re-run with -deprecation for details\ndefined object AwsClient\n"}]}},{"text":"%md\nWell done! Vous pouvez maintenaient explorer les donnees via le notebook gdeltExploration.json","user":"anonymous","dateUpdated":"2021-01-25T20:36:49+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Well done! Vous pouvez maintenaient explorer les donnees via le notebook gdeltExploration.json</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1611607009235_1231214714","id":"20181212-100557_635513911","dateCreated":"2021-01-25T20:36:49+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3925"}],"name":"GDELT_download","id":"2FXUANV4E","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}